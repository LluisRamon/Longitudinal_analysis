---
title: "Study of the efficacy of Berenil applied to trypanosomosis's infected cattle"
author: "Gerard Castell√†, Mathieu Marauri and Lluis Ramon"
date: \today
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
---

```{r, echo = FALSE, warning = FALSE}
library("knitr")
library("ggplot2")
library("xtable")
opts_chunk$set(echo = FALSE, eval = TRUE, warning = FALSE)
```

```{r}
cows <- read.table("data/cattle_mes dades.txt", header = TRUE, 
                   sep = "\t", dec = ",", na.strings = "")

names(cows) <- c("id", "dose", "pcv", "time", "nbirth")
cows$dose <- factor(cows$dose, levels = c("L", "M", "H"))
```


# Introduction

Cattle are an important economic resource and also a major health factor in many countries. Therefore preventing diseases in a herd is vital. 

In this study we focus our interest on the parasite of trypanosomosis which can lead to the death of a cow. This disease, transmitted by the tsetse flies, causes an infection characterized by fever, loss of apetite and anaemia, which can lead to death depending on different factors.

One medicine, the Berenil, is used to cure the infected cattle. The aim of this research is to determine the efficiency of different doses of Berenil. Finding the most efficient dose, if such a dose exists, is critical when it comes to save both cattle and money. Here lies all the interest of our study. 

To assess the severity of the disease, the Packed-Cell Volume (PCV) is shown to be a good indicator. The PCV is the percentage of red blood cells in blood. The lower the PCV is, the less healthy the cow is. 

# Objective

The aim of this study is to assess the efficacy of different doses of Berenil in cattle infected with the trypanosomosis parasite.

# Dataset

A cohort of 10 different cows infected by trypanosomosis parasite was selected for the study. Each  Berenil dose (low, medium and high) was administrated three times (time 1, 2 or 3) for each animal. PCV was reported each time as well as the number of calves it had before being infected.

The variables reported for this study are presented below.

* Id: Each cow has its own id. From 1 to 10. _(id)_
* PCV: From 14.30 to 33.30. _(pcv)_
* Dose: H High, M Medium L low. _(dose)_
* Time: From 1 to 3. _(time)_
* Number of birth: From 2 to 8. _(nbirth)_

Since the gathering process of the data was unkonw, several assumptions were needed.

* Each time PCV is obtained before the treatment. Therefore the effect of the third dose could not be evaluated.
* Dose is assigned randomly in time to the cow.
* For a given cow, the previous treatments (high, medium or low) do not affect the following ones.
* Missings are complitely at random.
* Time intervals are the same and fixed.

# Statistical methods

The methods used in the statistical analyses are detailled in this section. First a multivariate model was fitted, then a two stage analysis and finally a random effect model. An exploratory data analysis was performed before those regression methods.

## Multivariate model

Despite the fact of not being the optimal choice, a multivariate linear model was fitted to the data. It seems reasonable to think that observations are not independent, since they are comming from the same cow. However, this model could also led to some interesting results.

The response variable was PCV since the severity the disease was evaluated by this parameter. As we wanted to estimate the effect of dose in diseased cows in time, these two variables were included in the model. 

From this initial model, a forward stepwise method was carried for the model selection,  including additional covariates or interactions between them. The models were compared using F-test. This procedure was followed until no other covariates or interactions below 3rd order could be added, because they would not produce a significantly better model. Leading this to the most parsimonious model with all significant variables.

A validation of the model was performed to check that the residuals were normal, homoscedastic and independent between them and to other rellevant covariates. 

## Two-stage analysis

A Two-stage analysis was performed to take into acount variability between subjects.

In the first stage model, 3 linear regression models were done for each subject separately, one for each dose (High, Medium, Low).  The response variable  was PVC and time the covariate. 

In the second stage model, a linear regression model was fitted for the subject-specific regression coefficients using dose as a covariate. It was also studied the cow effect or the number of births effect.

## Random-effects model

Since the Two Stage model didn't take into acount the within subjects variability, a Random-effects model was fitted. 

It distinguishes the mean structure of the covariates as a fixed effect and also some variability between and within subjects as a random effects. It allows more flexibility to model.

The methodology for model selection was the following as proposed by Verbeke and Molenberghs:

1. Selection of a Preliminary Mean Structure
2. Selection of a Preliminary Random-Effects Structure
3. Selection of a Residual Covariance Structure
4. Model Reduction

A validation of the model was performed to check that the residuals were normal, homoscedastic and independent between them and to other rellevant covariates. 


# Summary statistics

In this part the aim is to have some insights about the data. By performing a basic statistical analysis some relations between the explaining variables and the response one would emerged. A first idea on how we can explain the response variable and also some answers when it comes to discovering the most efficient dose.

```{r qplot, fig.cap = "PCV evolution for each cow on every dose. Cows are colored in the same fashion for each dose. \\label{fig:qplot}"}
qplot(factor(time), pcv, data = cows, group = id, geom = "line", facets = .~ dose, 
      colour = factor(id)) + scale_color_discrete(guide = 'none')
```


PCV values seem similar for each dose at time 1, which makes sense with several assumptions previously stated. Especially the fact that the PCV is taken before treatment. The unfinished evolutions in Figure \ref{fig:qplot} represent missing values in the data, more details about missing data are reported in the section \ref{sec:Missings}. Notice that several cows with low PCV values in Low dose also have low PCV values in the other doses. 

Cows treated with high doses tend to have a better evoloution in their PCV values. One could also think that time has an influence on the PCV in the way that the effect of the second dose seems to be less important than the first one. 


The mean influence of the covariate *time* is expected to be positive. Indeed one expects to higher PCV values after treatment. Also the High dose is expected to be more efficient than the Medium and Low one. This can be verified in Figure \ref{fig:boxplot_time_dose}.

```{r boxplot, fig.cap = "Boxplot of PCV values for each time and dose. \\label{fig:boxplot_time_dose}"}
cows$timeDose <- paste(cows$time, cows$dose, sep = ".")
cows$timeDose <- factor(cows$timeDose, levels = c("1.L", "2.L", "3.L", "1.M", "2.M", "3.M", "1.H", "2.H", "3.H"))
ggplot(aes(timeDose, pcv, fill = dose), data = cows) + geom_boxplot()
cows$timeDose <- NULL
```

In Figure \ref{fig:boxplot_time_dose} it can be apreciated that there is not a big difference between the low and the medium doses. However the High dose is much better than the others. For instance the mean PCV value at time 2 for the High dose is bigger than mean PCV value at time 3 for the Medium or Low dose.

## Number of births

None of the cows gave birth after time 1 of the first infection. So the number of births remains constant through all doses and times for each cow. 

Some boxplots were performed but it didn't show any clear result, although a tendency may be seen at time 1. A simple regression model was also fit at time 1 with a significant (p = 0.007) a slope  of -0.3444. It may explain the fact that a cow is supposed to be weaker if it had a lot of calves. Latter on the analysis the nbirth effect will be combined with other variables.

```{r, eval = FALSE}
lcowsnbirth <- lm(pcv ~ nbirth, data = cows[cows$time == 1,])
summary(lcowsnbirth)
```

## Missing data analysis
\label{sec:Missings}

There are 14 missing PCV values out of 90 observations in the dataset. Those missing values are equally distributed among doses and time as it is shown in Table 1.

```{r, results = 'asis'}
cows.com <- na.omit(cows)
missingsTable <- 10 - table(cows.com$dose, cows.com$time)
xtable(missingsTable, digits = 0, caption = "Number of missings in PCV for time and dose")
```

It seems to be a contradiction with the assumption that missings are randomly distributed. In the study all those missings will be removed and not further analyzed nor imputed.

## Correlation structure

```{r}
library("corrplot")
library("tidyr")
cows.w <- spread(cows, time, pcv)
corrplot(cor(cows.w[, c("1", "2", "3")], use = "pairwise.complete.obs"), "ellipse")
```


# Results

Each cow in this dataset was treated three times, hence we will, at the beginning at least, consider that our dataset contains 30 different cows identified by id and dose. Later on this assumption will be released. The idea behind this differentiation within the same cow is due to the fact that a different Berenil dose was given for each infection. That is to say each cow has been infected three different times by the parasite.

## Multivariate model

## Two stage 

__Stage 1 Model__

$PCV_{ij} = \beta_{0ij} + \beta_{1ij}time + \epsilon_{ij}$ and $\epsilon_{ij} \sim N(0, \Sigma_ij)$


__Stage 2 Model__

$\beta_{0ij} = \beta_0 + \beta_1 doseMedium + \beta_2 doseHigh + \beta_3 numbirths + b_{0ij}$

$\beta_{1ij} = \beta_4 + \beta_5 doseMedium + \beta_6 doseHigh + \beta_7 numbirths + b_{1ij}$

where $b_i \sim N(0, D)$


Comments:

* Dose reference value is Low
* Include numbrith or not
* Complete cases only
* idDose 9L i 6L just one observation. No slope.
* Results

## Random effects



$PCV_{i} = (\beta_{0} + b_{0i}) + (\beta_{1} + b_{1i})time + \beta_2 doseMedium + \beta_3 doseHigh + \beta_4 numbirths + \epsilon_{i}$ and $\epsilon_{i} \sim N(0, \Sigma_ij)$


# Discussion

Giving birth is supposed to weaken the cow, besides *nbirth* is also an indicator of how old the cow is.


# Limitations and Further research

# Bibliography

* [Bovine trypanosomiasis in south-western Uganda: packed-cell volumes and prevalences of infection in the cattle.](http://www.ncbi.nlm.nih.gov/pubmed/15000727)
* [Evaluating the use of packed cell volume as an indicator of trypanosomal infections in cattle in eastern Zambia](http://www.sciencedirect.com/science/article/pii/S0167587708001098#)
* [Linear Mixed Models for Longitudinal Data](http://www.springer.com/gp/book/9781441902993)